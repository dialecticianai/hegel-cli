# Research mode workflow - optimized for knowledge gathering
mode: research
start_node: plan

nodes:
  plan:
    summary: Define research priorities and scope for knowledge gathering.
    prompt: |
      You are in the PLANNING phase of Research Mode (Dialectic-Driven Development).

      {{STUDY_PLANNING}}

      Your task: Define research priorities and scope.
      {{?context_note}}
    rules:
      - type: require_commits
        lookback_phases: 1
    transitions:
      - when: "plan_complete"
        to: study

  study:
    summary: Study external sources systematically and synthesize insights into learning documents.
    prompt: |
      You are in the STUDY phase of Research Mode (Dialectic-Driven Development).

      {{KNOWLEDGE_CAPTURE}}

      Your task: Study external sources and synthesize into learning documents.
      {{?context_note}}

      Research activities:
      - Cache external docs to .webcache/ for offline access (use curl, lynx -dump for reading)
      - Read systematically (don't jump around, follow your priority plan)
      - Synthesize into learnings/*.md (not transcription - extract patterns, constraints, gotchas)
      - Cross-reference sources (link back to originals in attribution footers)

      Focus on:
      - What patterns emerge across sources
      - What constraints matter for building
      - What gotchas/edge cases exist
      - What questions arise (theory vs practice gaps)

      Knowledge capture is about UNDERSTANDING, not accumulation. Distill, don't dump.

      Respond when you've completed a study priority/phase and are ready to assess.
    rules:
      - type: require_commits
        lookback_phases: 1
      - type: token_budget
        max_tokens: 15000
    transitions:
      - when: "study_complete"
        to: assess
      - when: "continue_study"
        to: study

  assess:
    summary: Reflect on learning progress, insights gained, and decisions made during study.
    prompt: |
      You are in the ASSESSMENT phase of Research Mode (Dialectic-Driven Development).

      Your task: Meta-cognitive reflection on what you've learned.
      {{?context_note}}

      Create a phase assessment document (e.g., learnings/.ddd/N_description.md):

      Focus on:
      - What did you study (pages, docs, sources)
      - Key insights (not just facts, but implications)
      - Questions answered (from previous phases)
      - Questions raised (theory vs practice gaps)
      - Decisions made (with rationale)
      - What's next (continue study or transition to Discovery)

      Meta-learning documents are thinking artifacts. They capture:
      - Progress (what's covered, what remains)
      - Understanding (insights, not just facts)
      - Uncertainty (what needs practical validation)

      Number these sequentially (0_, 1_, 2_...) so filesystem keeps them ordered.

      Respond with your completed assessment document.
    transitions:
      - when: "assess_complete"
        to: questions
      - when: "assess_incomplete"
        to: study

  questions:
    summary: Catalogue open questions discovered during research as a bridge to Discovery mode.
    prompt: |
      You are in the QUESTIONS phase of Research Mode (Dialectic-Driven Development).

      {{QUESTION_TRACKING}}

      Your task: Catalogue all open questions discovered during research.
      {{?context_note}}

      Create/update consolidated questions document (e.g., learnings/.ddd/5_open_questions.md):

      Focus on:
      - Categorize questions by domain/subsystem
      - Distinguish: answered (during study) vs open (need practice)
      - Cross-reference to learning docs (where's the theory)
      - Cross-reference to practice path (which toy/experiment will answer)
      - Mark decisions made vs deferred

      Open questions become the Discovery mode roadmap:
      - Each question → potential toy experiment
      - Each category → potential integration toy
      - Prioritize by: foundational → advanced

      This document is the bridge: Research → Discovery.

      Respond with your completed/updated questions document.
    rules:
      - type: require_commits
        lookback_phases: 2
    transitions:
      - when: "questions_complete"
        to: done

  done:
    transitions: []
