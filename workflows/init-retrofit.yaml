# Retrofit initialization workflow - add DDD to existing project
mode: init
start_node: detect_existing

nodes:
  detect_existing:
    prompt: |
      You are retrofitting Dialectic-Driven Development to an existing project.

      {{PROJECT_DETECTION}}

      {{?context_note}}
    transitions:
      - when: detect_existing_complete
        to: code_map

  code_map:
    prompt: |
      You are in the CODE_MAP phase (Retrofit Mode).

      {{CODE_MAP_WRITING}}

      Your task: Create CODE_MAP.md files to document existing codebase structure.
      {{?context_note}}
    transitions:
      - when: code_map_complete
        to: customize_claude

  customize_claude:
    prompt: |
      You are in the CLAUDE.md customization phase (Retrofit Mode).

      {{CLAUDE_CUSTOMIZATION}}

      Your task: Create CLAUDE.md integrating with existing project conventions.
      {{?context_note}}
    transitions:
      - when: customize_claude_complete
        to: vision

  vision:
    prompt: |
      You are in the VISION phase (Retrofit Mode).

      {{VISION_WRITING}}

      Your task: Create VISION.md or integrate with existing documentation.
      {{?context_note}}
    transitions:
      - when: vision_complete
        to: architecture

  architecture:
    prompt: |
      You are in the ARCHITECTURE phase (Retrofit Mode).

      {{ARCHITECTURE_WRITING}}

      Your task: Document existing architecture or create ARCHITECTURE.md.
      {{?context_note}}
    transitions:
      - when: architecture_complete
        to: git_commit

  git_commit:
    prompt: |
      Retrofit initialization nearly complete.

      {{GIT_INITIALIZATION}}

      {{?context_note}}
    transitions:
      - when: git_commit_complete
        to: done

  done:
    prompt: |
      DDD retrofit complete.

      Next steps:
      - Review CLAUDE.md, VISION.md, ARCHITECTURE.md, CODE_MAP.md files
      - Run 'hegel start discovery' to explore first refactoring or feature
      - If on feature branch: consider creating PR for team review

      Retrofit initialization finished successfully.
    transitions: []
